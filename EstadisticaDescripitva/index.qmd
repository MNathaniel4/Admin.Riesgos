---
title: "01.c Tarea de repaso de Estadística descripiva"
author: "Equipo 3"
format:
    pdf:  
      toc: TRUE
      toc-depth: 4 
    html:
      toc: TRUE
      toc-depth: 4
       
---

Hecho por:
  
  Julio César Lopez Becerra^[1609936x@umich.mx]
  
  Juan Diego Hernadez Zavala^[2209978x@umich.mx]
  
  Franscisco Alvarez Aguilera^[1911217e@umich.mx]
  
  Mario Nathaniel de la Vega Ramírez^[1825934f@umich.mx]


Univerdidad Michoacana de San Nicolás de Hidalgo
![](../Imagenes/Escudoum.jpg)


```{r setup, include=FALSE}
library(plotly)
library(tidyverse)
library(lubridate)
#Librería para gráficar Matrices de correlación_
library(corrplot)
# Librería de Yahoo Finance para descargar datos:
source("https://raw.githubusercontent.com/OscarVDelatorreTorres/yahooFinance/main/datosMultiplesYahooFinance.R")
```

### Descarga de datos

Por favor, genera un documento en Quarto y descargue los históricos de los últimos 3 años de Yahoo Finance:

Acciónes mexicanas: ALFAA.MX, BIMBOA.MX, GFNORTEO.MX, GRUMAB.MX, LACOMERUBC.MX y VOLARA.MX
Acciónes americanas: AAPL, GOOGL, META, GRMN, ARKF y ARKX
Índices bursátiles: IPC(^MXX), Dow Jones(^DJI) y S&P500(^GSPC)
Futuros: Pétroleo(WIT), Maíz(ZC=F), Azúcar(SF=F) y Oro(GC=F)


```{r}
tickerV=c("ALFAA.MX","BIMBOA.MX","GFNORTEO.MX","GRUMAB.MX","LACOMERUBC.MX","VOLARA.MX","AAPL","GOOGL","META","GRMN","ARKF","ARKX","^MXX","^DJI","^GSPC","WTI","ZC=F","GC=F", "SB=F")
deD=Sys.Date()-365*3
hastaD=Sys.Date()
per="D"
paridadFX="USDMXN=X"
convertirFX=c(FALSE,FALSE,FALSE,FALSE,FALSE,FALSE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE,FALSE,TRUE,TRUE,TRUE,TRUE,TRUE,TRUE)

Datos=historico_multiples_precios(tickers=tickerV,de=deD,hasta=hastaD,periodicidad=per,fxRate=paridadFX,whichToFX=convertirFX)
```

### Estadística descriptiva

De estos, con el rendimiento contínuo y el P/L haga una tabla de resumen (para cada uno) que tenga:

  -Media 
  
  -Mediana
  
  -Desviación Estandar
  
  -Quantil 5%
  
  -Quantil 95%
  
  -Maximo
  
  -Mínimo
  
  -Conteo

```{r}
tablaResumenPL=data.frame(Accion=names(Datos$tablaPL)[-1],
                        Media = colMeans(Datos$tablaPL[,-1]),
                        Mediana = apply(Datos$tablaPL[,-1],2,median),
                        DesviacionEstandar=apply(Datos$tablaPL[,-1],2,sd),
                        q5=apply(Datos$tablaPL[,-1],2, quantile, probs =0.05),
                        q95=apply(Datos$tablaPL[,-1],2, quantile, probs=0.95),
                        max=apply(Datos$tablaPL[,-1],2,max),
                        min=apply(Datos$tablaPL[,-1],2,min),
                        Conteo=apply(Datos$tablaPL[,-1],2,length)
                        )
tablaResumenPL
```

```{r}

tablaResumenRendimientos=data.frame(Accion=names(Datos$tablaRendimientosCont)[-1],
                        Media = colMeans(Datos$tablaRendimientosCont[,-1]),
                        Mediana = apply(Datos$tablaRendimientosCont[,-1],2,median),
                        DesviacionEstandar=apply(Datos$tablaRendimientosCont[,-1],2,sd),
                        q5=apply(Datos$tablaRendimientosCont[,-1],2, quantile, probs =0.05),
                        q95=apply(Datos$tablaRendimientosCont[,-1],2, quantile, probs=0.95),
                        max=apply(Datos$tablaRendimientosCont[,-1],2,max),
                        min=apply(Datos$tablaRendimientosCont[,-1],2,min),
                        Conteo=apply(Datos$tablaRendimientosCont[,-1],2,length)
                        )
tablaResumenRendimientos
```


Haga una trágica en plotly que tenga 3 paneles con las siguientes figuras:

  -Precios base 100 a la fecha inicial.

  -P/L. 

  -Rendimiento contínuo.

```{r}

DatosGraficaPL=Datos$tablaPL %>%
  pivot_longer(cols=-Date,names_to="Ticker",values_to="PL")
DatosGraficaPL


base100Calc=function(x){
  return((x/x[1])*100)
}

preciosB100=Datos$tablaPrecios[,-1]

preciosB100=apply(preciosB100,2,base100Calc)

preciosB100=cbind(data.frame(Date=Datos$tablaPrecios$Date),
                  preciosB100)


DatosGraficaPreciosB100=preciosB100 %>%
  pivot_longer(cols=-Date,names_to="Ticker",values_to="PrecioBase100")


DatosGraficaRendimientos=Datos$tablaRendimientosCont %>%
  pivot_longer(cols=-Date,names_to="Ticker",values_to="RendimientoCont")
DatosGraficaRendimientos

fig1a=plot_ly()%>%
  add_trace(data=DatosGraficaPL,
            x=~Date,
            y=~PL,
            color=~Ticker,
            type="scatter",
            mode="lines")
fig1b=plot_ly()%>%
  add_trace(data=DatosGraficaPreciosB100,
            x=~Date,
            y=~PrecioBase100,
            color=~Ticker,
            type="scatter",
            mode="lines")
fig1c=plot_ly()%>%
  add_trace(data=DatosGraficaRendimientos,
            x=~Date,
            y=~RendimientoCont,
            color=~Ticker,
            type="scatter",
            mode="lines")

fig1=subplot(fig1a,fig1b,fig1c,
             nrows=3,
             shareX=TRUE, 
             titleY=TRUE) %>%
  layout(title="Comparativo de acciones",
         yaxis=list(title="PL (%)"),
         yaxis2=list(title="Precio Base 100"),
         yaxis3=list(title="Rendimiento Contínuo (%)"))
fig1

```

## Matriz de dispersión

Haga una matriz de dispersión (https://plotly.com/r/splom/).

```{r}
##figScatter=plot_ly(type="splom",
#                    dimensions=list(
#                      list(label="ALFAA.MX", values=Datos$tablaRendimientosCont$ALFAA.MX),
#                      list(label="BIMBOA.MX", values=Datos$tablaRendimientosCont$BIMBOA.MX),
#                      list(label="GFNORTEO.MX", values=Datos$tablaRendimientosCont$GFNORTEO.MX),
#                      list(label="GRUMAB.MX", values=Datos$tablaRendimientosCont$GRUMAB.MX),
#                      list(label="LACOMERUBC.MX", values=Datos$tablaRendimientosCont$LACOMERUBC.MX),
#                      list(label="VOLARA.MX", values=Datos$tablaRendimientosCont$VOLARA.MX),
#                      list(label="AAPL", values=Datos$tablaRendimientosCont$AAPL),
#                      list(label="GOOGL", values=Datos$tablaRendimientosCont$GOOGL),
#                      list(label="META", values=Datos$tablaRendimientosCont$META),
#                      list(label="GRMN", values=Datos$tablaRendimientosCont$GRMN),
#                      list(label="ARKF", values=Datos$tablaRendimientosCont$ARKF),
#                      list(label="ARKX", values=Datos$tablaRendimientosCont$ARKX),
#                      list(label="^MXX", values=Datos$tablaRendimientosCont$MXX),
#                      list(label="^DJI", values=Datos$tablaRendimientosCont$DJI),
#                      list(label="^GSPC", values=Datos$tablaRendimientosCont$GSPC),
#                      list(label="WTI", values=Datos$tablaRendimientosCont$WTI),
#                      list(label="ZC=F", values=Datos$tablaRendimientosCont$ZCF),
#                      list(label="GC=F", values=Datos$tablaRendimientosCont$GCF),
#                      list(label="SB=F", values=Datos$tablaRendimientosCont$SBF)
#                    ),
#                    marker=list(size=3,
#                                color='rgba(0, 0, 255, 0.5)',
#                                line=list(width=1,
#                                          color='rgb(0, 0, 0)')),
#                    diagonal=list(visible=FALSE)
#                    ) %>%
#   layout(title="Matriz de dispersión de los rendimientos contínuos")
# 
# 
# figScatter

```
```{r}
# figScatt = pairs(Datos$tablaPL[,-1], main = "Matriz de dispersión de los rendimientos contínuos")

```



## Covarianzas y correlaciones:

Covarianzas de los rendimientos:
```{r}
covarianzasRC=cov(Datos$tablaRendimientosCont[,-1])
covarianzasRC
```
```{r}

covarianzasPL=cov(Datos$tablaPL[,-1])
covarianzasPL

```




Correlaciones Pearson:
```{r}
correlacionesRC=cor(Datos$tablaRendimientosCont[,-1])
correlacionesRC
```

```{r}
correlacionesPL=cor(Datos$tablaPL[,-1])
correlacionesPL
```


Se hace un diagrama de calor (heatmap) de las covarianzas de los rendimientos:

```{r}
fig3a = corrplot(correlacionesRC, title = "Matriz de correlaciones Rendimientos")
```

```{r}


fig3b = corrplot(correlacionesPL, title = "Matriz de correlaciones P/L")

```
### Conclusiones

Gracias al análisis estadístico descriptivo realizado, podemos sacar algunas de las siguientes concusiones:

Si hubieramos invertido hace 3 años en las acciones análizadas sin hacer nigún movimiento, a dia de hoy el máximo rendimiento que hubieramos sacado sería el de META, y el que nos hubiera generado más perdidas sería el futuro en petroleo WIT.

Sí se hubiera sacado el rendimiento el dia del mayor rendimiento reportado, meta queda en 2do lugar con 19.54%, mientras que Garmin nos hubiera proporcionado un 21.02%.

El activo con mayor volatilidad es el futuro del petroleo, WTI, mientras que el menos volátil es el indicie bursátil IPC.
                               
Las acciones americanas en general tuvieron mejor desempeño que las mexicanas.

Algunos de los activos analizados tienen una relación directa muy fuerte, como es el caso de los futuros del oro y Dow Jones, o los índices bursátiles Dow Jones y S&P500. 

Vemos que el sector teconlógico, y en general las acciones americanas tienen una relación directa fuerte entre ellas, así como sus indices busatiles, y como es de esperarse, el IPC tiene una relación directa con los activos méxicanos.

Hay una relación que probablemente sea espuria, que es el futuro del maíz y del oro, y que sería interesanre agregar 
al análisis alguas pruebas de cointegración, para verificar que esta realción es real.


