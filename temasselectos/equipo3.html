<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.7.32">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Equipo 3">

<title>E.01 Matemática de portafolios acorde a Markowitz y el cálculo del VaR de un portafolio de acciones.</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="equipo3_files/libs/clipboard/clipboard.min.js"></script>
<script src="equipo3_files/libs/quarto-html/quarto.js" type="module"></script>
<script src="equipo3_files/libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="equipo3_files/libs/quarto-html/popper.min.js"></script>
<script src="equipo3_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="equipo3_files/libs/quarto-html/anchor.min.js"></script>
<link href="equipo3_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="equipo3_files/libs/quarto-html/quarto-syntax-highlighting-37eea08aefeeee20ff55810ff984fec1.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="equipo3_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="equipo3_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="equipo3_files/libs/bootstrap/bootstrap-bb462d781dde1847d9e3ccf7736099dd.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="quarto-light">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#la-teoría-de-portafolios-de-markowitz" id="toc-la-teoría-de-portafolios-de-markowitz" class="nav-link active" data-scroll-target="#la-teoría-de-portafolios-de-markowitz">La Teoría de Portafolios de Markowitz</a>
  <ul>
  <li><a href="#rendimiento-esperado-de-un-activo-y-de-un-portafolio" id="toc-rendimiento-esperado-de-un-activo-y-de-un-portafolio" class="nav-link" data-scroll-target="#rendimiento-esperado-de-un-activo-y-de-un-portafolio">Rendimiento esperado de un activo y de un portafolio</a></li>
  <li><a href="#riesgo-varianza-o-volatilidad-de-un-portafolio" id="toc-riesgo-varianza-o-volatilidad-de-un-portafolio" class="nav-link" data-scroll-target="#riesgo-varianza-o-volatilidad-de-un-portafolio">Riesgo (Varianza o Volatilidad) de un portafolio</a></li>
  <li><a href="#covarianza-y-correlación" id="toc-covarianza-y-correlación" class="nav-link" data-scroll-target="#covarianza-y-correlación">Covarianza y Correlación</a></li>
  <li><a href="#formulación-matemática" id="toc-formulación-matemática" class="nav-link" data-scroll-target="#formulación-matemática">Formulación Matemática</a></li>
  <li><a href="#el-problema-de-markowitz-y-la-frontera-eficiente" id="toc-el-problema-de-markowitz-y-la-frontera-eficiente" class="nav-link" data-scroll-target="#el-problema-de-markowitz-y-la-frontera-eficiente">El Problema de Markowitz y la Frontera Eficiente</a></li>
  </ul></li>
  <li><a href="#valor-en-riesgo-var" id="toc-valor-en-riesgo-var" class="nav-link" data-scroll-target="#valor-en-riesgo-var">Valor en Riesgo (VaR)</a>
  <ul>
  <li><a href="#metodología-para-el-cálculo-de-var" id="toc-metodología-para-el-cálculo-de-var" class="nav-link" data-scroll-target="#metodología-para-el-cálculo-de-var">Metodología para el cálculo de VaR</a></li>
  <li><a href="#modelo-paramétrico" id="toc-modelo-paramétrico" class="nav-link" data-scroll-target="#modelo-paramétrico">Modelo Paramétrico</a></li>
  </ul></li>
  <li><a href="#ejemplo-teoría-de-portafolio-de-markowitz" id="toc-ejemplo-teoría-de-portafolio-de-markowitz" class="nav-link" data-scroll-target="#ejemplo-teoría-de-portafolio-de-markowitz">Ejemplo Teoría de Portafolio de Markowitz</a>
  <ul>
  <li><a href="#riesgo-y-retorno-esperado" id="toc-riesgo-y-retorno-esperado" class="nav-link" data-scroll-target="#riesgo-y-retorno-esperado">Riesgo y retorno esperado</a>
  <ul class="collapse">
  <li><a href="#retorno-esperado" id="toc-retorno-esperado" class="nav-link" data-scroll-target="#retorno-esperado">Retorno esperado</a></li>
  <li><a href="#riesgo-esperado" id="toc-riesgo-esperado" class="nav-link" data-scroll-target="#riesgo-esperado">Riesgo esperado</a></li>
  </ul></li>
  <li><a href="#para-una-cartera-de-dos-activos" id="toc-para-una-cartera-de-dos-activos" class="nav-link" data-scroll-target="#para-una-cartera-de-dos-activos">Para una cartera de dos activos:</a>
  <ul class="collapse">
  <li><a href="#fórmula-de-markowitz-optimo" id="toc-fórmula-de-markowitz-optimo" class="nav-link" data-scroll-target="#fórmula-de-markowitz-optimo">Fórmula de Markowitz (% optimo)</a></li>
  </ul></li>
  </ul></li>
  <li><a href="#ejemplos-del-cálculo-del-var-de-un-portafólio" id="toc-ejemplos-del-cálculo-del-var-de-un-portafólio" class="nav-link" data-scroll-target="#ejemplos-del-cálculo-del-var-de-un-portafólio">Ejemplos del cálculo del VaR de un portafólio</a>
  <ul>
  <li><a href="#cálculo-del-portafolio-de-mínima-varianza" id="toc-cálculo-del-portafolio-de-mínima-varianza" class="nav-link" data-scroll-target="#cálculo-del-portafolio-de-mínima-varianza">Cálculo del portafolio de mínima varianza</a></li>
  <li><a href="#resultados" id="toc-resultados" class="nav-link" data-scroll-target="#resultados">Resultados</a></li>
  <li><a href="#cálculo-del-var-paramétrico-del-portafolio" id="toc-cálculo-del-var-paramétrico-del-portafolio" class="nav-link" data-scroll-target="#cálculo-del-var-paramétrico-del-portafolio">Cálculo del VaR paramétrico del portafolio</a></li>
  </ul></li>
  </ul>
<div class="quarto-alternate-formats"><h2>Other Formats</h2><ul><li><a href="equipo3.pdf"><i class="bi bi-file-pdf"></i>PDF</a></li></ul></div></nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">E.01 Matemática de portafolios acorde a Markowitz y el cálculo del VaR de un portafolio de acciones.</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Equipo 3 </p>
          </div>
  </div>
    
  
    
  </div>
  


</header>


<p><a href="https://mnathaniel4.github.io/Admin.Riesgos/temasselectos/pp">Presentación</a></p>
<p><br>
</p>
<p><br>
</p>
<p><br>
Hecho por:</p>
<ul>
<li>Julio César López Becerra<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></li>
</ul>
<!-- -->
<ul>
<li>Juan Diego Hernández Zavala<a href="#fn2" class="footnote-ref" id="fnref2" role="doc-noteref"><sup>2</sup></a></li>
</ul>
<!-- -->
<ul>
<li>Francisco Alvarez Aguilera<a href="#fn3" class="footnote-ref" id="fnref3" role="doc-noteref"><sup>3</sup></a></li>
</ul>
<!-- -->
<ul>
<li>Mario Nathaniel de la Vega Ramírez<a href="#fn4" class="footnote-ref" id="fnref4" role="doc-noteref"><sup>4</sup></a></li>
</ul>
<p><strong>Universidad Michoacana de San Nicolás de Hidalgo</strong></p>
<p><img src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg-AEsvi0CFmM6Blq_wM67EJKaDQS7_KEf-4wd9U1J9jqs-oAGip3InqKyKBx0z76wGKFEAtRb9kiKBexyQCZSIE0PC7f-F00I5KqPXn1UL4t8RzDd3qcPsoIRYRi2pqRaIvjppNLAWdkI/s1600/Escudo+UMSNH.jpg" class="img-fluid" style="width:20.0%"></p>
<p><strong>Licenciatura en Actuaría y Ciencia de Datos</strong></p>
<p><img src="https://raw.githubusercontent.com/FranciscoAlvarezAguilera/E01-Markowitz/refs/heads/main/logo.png" class="img-fluid" style="width:30.0%"></p>
<p><br>
</p>
<p><br>
</p>
<p><br>
</p>
<section id="la-teoría-de-portafolios-de-markowitz" class="level2">
<h2 class="anchored" data-anchor-id="la-teoría-de-portafolios-de-markowitz">La Teoría de Portafolios de Markowitz</h2>
<ul>
<li><p>Pionera en formalizar matemáticamente el concepto de diversificación de inversiones.</p></li>
<li><p>Rendimiento esperado de un portafolio y su riesgo.</p></li>
<li><p>Minimizar el riesgo para un nivel de rendimiento dado, o maximizar el rendimiento para un nivel de riesgo aceptado.</p></li>
</ul>
<p>Conceptos fundamentales:</p>
<ol type="1">
<li><p>Riesgo</p></li>
<li><p>Rendimiento</p></li>
</ol>
<section id="rendimiento-esperado-de-un-activo-y-de-un-portafolio" class="level3">
<h3 class="anchored" data-anchor-id="rendimiento-esperado-de-un-activo-y-de-un-portafolio">Rendimiento esperado de un activo y de un portafolio</h3>
<p>Rendimiento:</p>
<ul>
<li><p>Activo individual: Cambio en su valor, respecto a su valor inicial.</p></li>
<li><p>Rendimiento esperado de portafolio: <span class="math display">\[ E(R_p) = \sum_{i} w_i \, E(R_i) \]</span> Forma Matricial: <span class="math display">\[ E(R_p) = w' E(r) \]</span><br>
</p></li>
</ul>
</section>
<section id="riesgo-varianza-o-volatilidad-de-un-portafolio" class="level3">
<h3 class="anchored" data-anchor-id="riesgo-varianza-o-volatilidad-de-un-portafolio">Riesgo (Varianza o Volatilidad) de un portafolio</h3>
<p>Medido comunmente como la varianza <span class="math display">\[ \sigma^{2} \]</span> o la desviación estándar <span class="math display">\[ \sigma \]</span> de sus rendimientos.</p>
</section>
<section id="covarianza-y-correlación" class="level3">
<h3 class="anchored" data-anchor-id="covarianza-y-correlación">Covarianza y Correlación</h3>
<p><span class="math display">\[ \sigma_{ij} \]</span> Mide la forma en que 2 activos diferentes se mueven juntos.</p>
<ul>
<li><p>(+) = Misma dirección, mayor riesgo</p></li>
<li><p>(-) = Distinta dirección, menor riesgo total <span class="math display">\[ \rho_{ij} \]</span> Estandariza la covarianza. Valor entre:</p></li>
<li><p>-1: En teoría, crear un portafolio sin riesgo.</p></li>
<li><p>1: No beneficio.</p></li>
</ul>
</section>
<section id="formulación-matemática" class="level3">
<h3 class="anchored" data-anchor-id="formulación-matemática">Formulación Matemática</h3>
<p><span class="math display">\[\sigma^2_p = w' V w \]</span> Varianza de un portafolio con n activos en notación matricial.</p>
<table class="caption-top table">
<thead>
<tr class="header">
<th><span class="math display">\[\sigma^2_p = w' V w \]</span></th>
<th>Varianza del portafolio</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><span class="math display">\[w\]</span></td>
<td>Vector columna de ponderaciones de los activos</td>
</tr>
<tr class="even">
<td><span class="math display">\[w'\]</span></td>
<td>Vector traspuesto de las ponderaciones</td>
</tr>
<tr class="odd">
<td><span class="math display">\[V\]</span></td>
<td>Matriz de varianza-covarianza de rendimientos de activos</td>
</tr>
</tbody>
</table>
</section>
<section id="el-problema-de-markowitz-y-la-frontera-eficiente" class="level3">
<h3 class="anchored" data-anchor-id="el-problema-de-markowitz-y-la-frontera-eficiente">El Problema de Markowitz y la Frontera Eficiente</h3>
<p>Minimizar <span class="math display">\[\ w' V w   y   \Sigma w_i = 1\]</span></p>
<p>Un inversor racional y adverso al riesgo elegirá un portafolio que se encuentre sobre la Frontera Eficiente.</p>
<p><img src="https://raw.githubusercontent.com/FranciscoAlvarezAguilera/E01-Markowitz/refs/heads/main/frontera.jpeg" class="img-fluid"></p>
</section>
</section>
<section id="valor-en-riesgo-var" class="level2">
<h2 class="anchored" data-anchor-id="valor-en-riesgo-var">Valor en Riesgo (VaR)</h2>
<p>Según el AEI 7.0:</p>
<p>Un portafolio o cartera de inversión es la combinación de activos objeto de inversión, como lo son todos los valores, títulos y documentos inscritos en el Registro Nacional de Valores en los que invierte algún fondo con la intención de “diversificar” el riesgo.</p>
<p>El riesgo en estos contextos se asocia a la incertidumbre en el valor de un activo, que regularmente se cuantifica mediante su:</p>
<p>Varianza y su volatilidad (desviación estándar) a lo largo del tiempo del activo(histórica).</p>
<p>Coeficiente <span class="math inline">\(\beta\)</span>: Indica la sensibilidad de un activo ante el mercado.</p>
<p>Para esto se usan las series de tiempo de los rendimientos diarios de ciertos índices, llamados benchmark que reflejan el comportamiento conjunto, por ejemplo, de las acciones disponibles en el mercado accionario. En México,el Índice de Precios y Cotizaciones se saca de una muestra del mercado accionario representativa, ponderada y balanceada, de las acciones que cotizan en la bolsa Mexicana de Valores. Los criterios para su construcción están disponibles en la página del S&amp;P Global (BMV). Y la serie de tiempo de los rendimientos de alguna acción del mercado que quieras analizar. Sean <span class="math inline">\(R_m\)</span> y <span class="math inline">\(R_i\)</span> las variables aleatorias que describen los rendimientos del mercado y el rendimiento de la acción a analizar en un tiempo determinado t, por ejemplo 5 años. Luego la <span class="math inline">\(\beta_i\)</span> a t años será.</p>
<p><span class="math display">\[Cov(R_m,R_i )\over Var(R_m)\]</span></p>
<p>Value at Risk(VaR): Es una estimación (Hipótesis) de la máxima pérdida posible en un intervalo de tiempo con cierto nivel de confianza.</p>
<p>Se basa en el supuesto de una distribución normal de los rendimientos de un portafolio X, y su representación es muy sencilla:</p>
<p><span class="math display">\[VaR_{(1-α)}^X=\mu_X (T-t)-\sigma_X (T-t)z_{(1-α)}\]</span></p>
<p>Donde <span class="math inline">\(X ~ N(\mu_X (T-t),\sigma_X (T-t))\)</span> <span class="math inline">\(\mu_X:\)</span> es el rendimiento esperado. <span class="math inline">\(\sigma_X:\)</span> la desviación estándar de los rendimientos. <span class="math inline">\(z:\)</span> el valor crítico de la distribución normal a <span class="math inline">\((1-\alpha)100%\)</span> de confianza.</p>
<p><span class="math inline">\((T-t)\)</span> es el intervalo de tiempo en el que se analizara el portafolio, donde usualmente se toman 5 y 10 días(<span class="math inline">\(5/360\)</span> ó <span class="math inline">\(10/360\)</span>)</p>
<p>Además, Artzener et all(1999) proponen ciertas propiedades para ser considerada una medida coherente de riesgo, a la diversificación y sus supuestos que como resulado, no sobrestima la cantidad de perdida y que reflejen de manera adecuada la reducción del riesgo cuando se diversifica. Sea <span class="math inline">\(X : \Omega \to \mathrm{I\!R}\)</span> es el cambio del valor del portafolio y <span class="math inline">\(A = \{\, X \mid X : \Omega \to \mathrm{I\!R} \,\}\)</span> el conjunto de todos los posibles cambios en el valor del portafolio, dónde Ω es una v.a asociada al cambio del valor de un portafolio.</p>
<p>Sean <span class="math inline">\(X\space,Y \in A\)</span> Si <span class="math inline">\(\rho∶ A \to\mathrm{I\!R}\)</span> es una medida coherente de riesgo cumple:</p>
<p>Monotonía no creciente. Si <span class="math inline">\(X\leq Y\)</span> entonces <span class="math inline">\(\rho(X) \geq \rho(Y)\)</span></p>
<p>Subadividad. <span class="math inline">\(\rho(X + Y )≤ \rho (X ) +\rho(Y )\)</span></p>
<p>Homogeneidad Positiva o Homogénea de grado uno. <span class="math inline">\(\lambda\geq0,\space \rho(\lambda X)= \lambda\bullet \rho(X)\)</span></p>
<p>Invarianza ante traslaciones. <span class="math inline">\(\rho(X+\alpha)= \rho(X)-\alpha\)</span></p>
<p>Curiosamente, ni la Varianza ni su volatilidad, ni el coeficiente Beta, ni el VaR tal como está definido son medidas de riesgo coherentes, ya que la varianza ni tiene homogeneidad positiva, pues las constantes salen al cuadrado, ni es invariante ante traslaciones, pues la varianza de una variable más una constante es igual a la varianza de la variable, y puede llegar a ser subaditiva, pero todo depende del signo de <span class="math inline">\(2∙Cov(X,Y)\)</span>. Además, no es capaz de detectar los efectos de colas más pesadas que puede tener consecuencias bastante graves. El coeficiente Beta, y el VaR tal como está definido ahora no cumple la propiedad de subaditividad.</p>
<p>Una medida de riesgo coherente es la llamada Esperanza condicional de la cola del VaR o AVaR, CvaR, TVaR, o simplemente Expected Shortfall, . <span class="math inline">\(\varepsilon_{(1-q)}^X=-E[X \space|\space X&lt; -VaR_{(1-q)}^X]\)</span></p>
<section id="metodología-para-el-cálculo-de-var" class="level3">
<h3 class="anchored" data-anchor-id="metodología-para-el-cálculo-de-var">Metodología para el cálculo de VaR</h3>
<div class="columns">
<div class="column" style="width:55%;">
<p>Medida estadística que cuantifica la pérdida máxima esperada en periodo de tiempo específico con nivel de confianza determinado.</p>
<p>Formalmente: <span class="math display">\[P(P_t - P_0 \le -VAR) = 1 - c \]</span></p>
</div><div class="column" style="width:45%;">
<p>Donde: <span class="math display">\[P_0\]</span> valor inicial del portafolio <span class="math display">\[P_t\]</span> valor al tiempo t <span class="math display">\[c\]</span> nivel de confianza</p>
</div>
</div>
<p>Los 3 métodos para el cálculo de VaR:</p>
<ul>
<li><p>Modelo Paramétrico</p></li>
<li><p>Modelo Histórico</p></li>
<li><p>Simulaciones</p></li>
</ul>
</section>
<section id="modelo-paramétrico" class="level3">
<h3 class="anchored" data-anchor-id="modelo-paramétrico">Modelo Paramétrico</h3>
<p>Método derivado directamente del modelo de Markowitz. Se asume un modelo normal, por lo tanto:</p>
<p>Sea 𝑤 el vector de pesos relativos de una cartera: <span class="math display">\[w = (w_1, w_2, ...,w_n)\]</span> Sea 𝑟 el vector de rendimientos: <span class="math display">\[𝑟 = (r_1,r_2,..., r_n)\]</span> Sea 𝑉 la matriz simétrica de 𝑛𝑥𝑛 de varianzas y covarianzas de rendimientos.</p>
<p>Sea x la cantidad invertida en cada activo: <span class="math display">\[x = (x_1, x_2,...,x_n)\]</span></p>
<p>Y W la cantidad total invertida: <span class="math display">\[W=\sum_{i=1}^{n} x_i\]</span></p>
<p>De modo que: <span class="math display">\[w_i= \frac{x_i}{W}\]</span></p>
<p>Dada la definición anterior, la varianza por unidad: <span class="math display">\[\sigma^2_p= w^{t}Vw\]</span> Por lo tanto, en términos de la inversión total W: <span class="math display">\[\sigma^2_pW^2= x^{t}Vx\]</span> Al asumir que el rendimiento es normal 𝑟 ∼ 𝑁(µ,𝑉), ,la distribución de la cartera es: <span class="math display">\[r_c∼N(\mu_c,\sigma^2_c),\mu_c= w^{T}\mu\]</span></p>
<p>Definimos la pérdida como: <span class="math display">\[L= W-W(1+r_c)=-Wr_c\]</span> La transformación lineal de una variable normal 𝑌=𝑎𝑋+𝑏 es otra variable aleatoria normalmente distribuida de la forma 𝑌∼𝑁(𝑎µ+𝑏,𝑎<sup>2σ</sup>2). Podemos definir la distribución de 𝐿 como: <span class="math display">\[L∼𝑁(-W\mu_c,W^2\sigma^2_c)\]</span> Esto permite definir VaR a nivel de significancia <em>p</em> como cuartil superior de 𝐿 con probabilidad <em>p</em>: <span class="math display">\[VaR_p=F^{-1}_L(1-p)\]</span></p>
<div class="columns">
<div class="column" style="width:50%;">
<p>Donde: <span class="math display">\[𝐹^{-1}_p\]</span> es función inversa de distribución acumulada de pérdidas. Aplicada a un valor de probabilidad, devuelve valor de pérdida para dicha probabilidad de la FDA.</p>
</div><div class="column" style="width:50%;">
<p>Ahora, para una normal de la forma <span class="math display">\[𝑌 ∼ 𝑁(𝑚, 𝑠^2)\]</span> se tiene que: <span class="math display">\[F^{-1}_Y(1-p)=m+s·z_{1-p}\]</span></p>
</div>
</div>
<div class="columns">
<div class="column" style="width:55%;">
<p>⇒<span class="math display">\[VaR_p=-W\mu_c+z_{1-p}W\sigma_c\]</span> Pero <span class="math display">\[\mu_c=W^T\mu\]</span> y <span class="math display">\[\sigma_c=\sqrt{w^{t}Vw}\]</span></p>
</div><div class="column" style="width:45%;">
<p>Por lo tanto, usando la suposición habitual (tiempo≤1 día, media=0): µ=0. Reescribimos: <span class="math display">\[VaR_p=z_{1-p}W\sqrt{w^{t}Vw}\]</span> <span class="math display">\[=z_{1-p}\sqrt{x^{t}Vx}\]</span></p>
</div>
</div>
</section>
</section>
<section id="ejemplo-teoría-de-portafolio-de-markowitz" class="level2">
<h2 class="anchored" data-anchor-id="ejemplo-teoría-de-portafolio-de-markowitz">Ejemplo Teoría de Portafolio de Markowitz</h2>
<section id="riesgo-y-retorno-esperado" class="level3">
<h3 class="anchored" data-anchor-id="riesgo-y-retorno-esperado">Riesgo y retorno esperado</h3>
<p>El cálculo del rendimiento esperado de una acción esta dado por su esperanza matemática decacuerdo con el modelo de Markowitz.</p>
<p>Simulando posibles escenarios futuros para la acción de Qualitas (Q.MX):</p>
<table class="caption-top table">
<caption>Qualitas Controladora, SAB De CV (Q.MX)</caption>
<tbody>
<tr class="odd">
<td>Economía</td>
<td>Precio</td>
<td>Probabilidad</td>
<td>Rendimiento</td>
</tr>
<tr class="even">
<td>Auge</td>
<td>$230.00</td>
<td>25%</td>
<td>41.59%</td>
</tr>
<tr class="odd">
<td>Esperado</td>
<td>$191.90</td>
<td>50%</td>
<td>18.14%</td>
</tr>
<tr class="even">
<td>Recesión</td>
<td>$156.00</td>
<td>25%</td>
<td>-3.95%</td>
</tr>
</tbody>
</table>
<section id="retorno-esperado" class="level4">
<h4 class="anchored" data-anchor-id="retorno-esperado">Retorno esperado</h4>
<p>El rendimiento esperado para Qualitas es estonces:</p>
<p><span class="math inline">\(E(R_Q) = \sum_{i=0}^{n}p*X_i\)</span></p>
<p><span class="math inline">\(E(R_Q) = (0.25)*(0.4159)+(0.50)*(0.1814)+(0.25)*(-0.0395)\)</span></p>
<p><span class="math inline">\(E(R_Q) = 0.1848\)</span></p>
</section>
<section id="riesgo-esperado" class="level4">
<h4 class="anchored" data-anchor-id="riesgo-esperado">Riesgo esperado</h4>
<p>La desviación estándar vista bajo este modelo, es el riesgo del título a evaluar.</p>
<p><span class="math inline">\(d_Q =\sigma_Q = 0.1610\)</span></p>
</section>
</section>
<section id="para-una-cartera-de-dos-activos" class="level3">
<h3 class="anchored" data-anchor-id="para-una-cartera-de-dos-activos">Para una cartera de dos activos:</h3>
<p>Para efectos de este ejemplo agregaremos los siguientes datos de la acción del Banco del Bajio (BBAJIOO.MX):</p>
<ul>
<li><p><span class="math inline">\(E(R_B)=0.2611\)</span></p></li>
<li><p><span class="math inline">\(\sigma_{B}^{2} = 0.0806\)</span></p></li>
<li><p><span class="math inline">\(\sigma_{B} = 0.2839\)</span></p></li>
<li><p><span class="math inline">\(Cov(Q,B)=0.02057\)</span></p></li>
</ul>
<section id="fórmula-de-markowitz-optimo" class="level4">
<h4 class="anchored" data-anchor-id="fórmula-de-markowitz-optimo">Fórmula de Markowitz (% optimo)</h4>
<p>Utilizando la formula de markowitz se puede llegar al porcentaje(peso) exacto a invertir en cada activo para que el riesgo de la cartera de dos títulos sea el mínimo:</p>
<p><span class="math display">\[w_Q = \frac{\sigma_B^2 - \text{Cov}(Q, B)}{\sigma_Q^2 + \sigma_B^2 - 2 \cdot \text{Cov}(Q, B)}\]</span> Sustituyendo nuestros valores tenemos que:</p>
<p><span class="math inline">\(w_Q=0.918115\)</span></p>
<p><span class="math inline">\(w_B = 1- w_Q = 0.081843\)</span></p>
<p>Por lo tanto, para esta cartera, debemos invertir mas del 90% de nuestro capital en acciones de Qualitas.</p>
<p>Ahora, para los demas valores esperados de nuestra cartera de dos activos:</p>
<ul>
<li><span class="math inline">\(E(R_p)= w_Q*E(R_Q)+w_B*E(R_B)\)</span></li>
</ul>
<p><span class="math inline">\(E(R_p)= (0.918115)*(0.1848)+(0.081843)*(0.2611)\)</span></p>
<p><span class="math inline">\(E(R_p)=0.191036\)</span></p>
<ul>
<li><span class="math inline">\(\sigma_p^2 = w_Q^2 \sigma_Q^2 + w_B^2 \sigma_B^2 + 2 w_Q w_B \text{Cov}(Q, B)\)</span></li>
</ul>
<p><span class="math inline">\(\sigma_p^2 = (0.842935)*(0.025921)+(0.006698)*(0.0806)+2*(0.918115)*(0.081843)*(0.02057)\)</span></p>
<p><span class="math inline">\(\sigma_p^2 = 0.02547\)</span></p>
<p><span class="math inline">\(\sigma_p = \sqrt{0.02547} = 0.159593\)</span></p>
<p>Esto es que el riesgo de esta cartera es de 15.95% aproximadamente, valor que cimple con la hipotesis de Markowitz de que diversificar con dos activos de diferente correlación nos lleva a un menor riesgo de cartera que si invirtieramos en cada acción de forma independiente.</p>
<p><span class="math display">\[\sigma_p &lt; \sigma_Q &lt; \sigma_B\]</span></p>
</section>
</section>
</section>
<section id="ejemplos-del-cálculo-del-var-de-un-portafólio" class="level2">
<h2 class="anchored" data-anchor-id="ejemplos-del-cálculo-del-var-de-un-portafólio">Ejemplos del cálculo del VaR de un portafólio</h2>
<ul>
<li>A fines de ilustración, se calculará el VaR paramétrico de un portafolio comupuesto por las acciónes de Grupo México, Televisa, CEMEX y Kimberly-Clark.</li>
</ul>
<p><img src="https://raw.githubusercontent.com/MNathaniel4/Admin.Riesgos/refs/heads/main/Imagenes/VaR_mario_2.PNG" class="img-fluid"></p>
<section id="cálculo-del-portafolio-de-mínima-varianza" class="level3">
<h3 class="anchored" data-anchor-id="cálculo-del-portafolio-de-mínima-varianza">Cálculo del portafolio de mínima varianza</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enfoque de  prgramación cuadraica</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="co"># mu =colMeans(Datos$tablaRendimientosCont[,-1])</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># sigma = cov(Datos$tablaRendimientosCont[,-1])</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Dmat &lt;- 2*sigma</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="co"># dvec &lt;- rep(0, ncol(sigma))</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Amat &lt;- cbind(rep(1, ncol(sigma)), diag(ncol(sigma)))</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="co"># bvec &lt;- c(1, rep(0, ncol(sigma)))</span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="co"># res &lt;- solve.QP(Dmat, dvec, Amat, bvec, meq=1)</span></span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a><span class="co"># w = res$solution</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a><span class="co"># r_port = sum(w * mu)</span></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a><span class="co"># sigma_port = sqrt(t(w) %*% sigma %*% w)</span></span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a><span class="co"># sigma_port = sigma_port[1,1]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="resultados" class="level3">
<h3 class="anchored" data-anchor-id="resultados">Resultados</h3>
<ul>
<li><p>De aquí, los pesos que el modelo arroja los pesos adecuados que minimizan la varianza son: <span class="math display">\[w = (0.2628, 0.0751, 0.1658, 0.4962)\]</span></p></li>
<li><p>Que desenvoca en un rendimiento esperado de <span class="math inline">\(r_{port} =\sum w_i*E[r_i]=  0.0922\)</span> y una desviación estándar de <span class="math inline">\(\sigma_{port}= \sqrt{w´\Sigma w} = 1.1399\)</span> , siendo <span class="math inline">\(\Sigma\)</span> la matriz de covarianza.</p></li>
</ul>
</section>
<section id="cálculo-del-var-paramétrico-del-portafolio" class="level3">
<h3 class="anchored" data-anchor-id="cálculo-del-var-paramétrico-del-portafolio">Cálculo del VaR paramétrico del portafolio</h3>
<ul>
<li>Con estos elementos procederemos al calculo del VaR paramétrico a un nivel de confianza del 95% y un horizonte de 10 días, de una suma invertida de $ 15,000.</li>
</ul>
<p><span class="math display">\[VaR_{parametrico} = - (q_{1-\alpha} * \sigma_{port} * \sqrt{h})*Valor\ invertido \]</span> <span class="math display">\[VaR_{parametrico} = - (1.645 * 0.0114 * \sqrt{10})*15,000 = 889.3968 \]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#alpha = 0.05</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="co">#h = 10</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="co">#VaR_parametrico = 15000 *-((qnorm(1-alpha)*sigma_port*sqrt(h))/100)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>1609936x@umich.mx<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn2"><p>2209978x@umich.mx<a href="#fnref2" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn3"><p>1911217e@umich.mx<a href="#fnref3" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
<li id="fn4"><p>1825934f@umich.mx<a href="#fnref4" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
        const codeEl = trigger.previousElementSibling.cloneNode(true);
        for (const childEl of codeEl.children) {
          if (isCodeAnnotation(childEl)) {
            childEl.remove();
          }
        }
        return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>