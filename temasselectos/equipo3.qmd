---
title: "E.01 Matem√°tica de portafolios acorde a Markowitz y el c√°lculo del VaR de un portafolio de acciones."
author: "Equipo 3"
format:
    html:
      toc: TRUE
      toc-depth: 4
    pdf:  
      toc: TRUE
      toc-depth: 4


---
[Presentaci√≥n](https://mnathaniel4.github.io/Admin.Riesgos/temasselectos/pp)

\

\

\
Hecho por:

-   Julio C√©sar L√≥pez Becerra[^1]

[^1]: 1609936x\@umich.mx

<!-- -->

-   Juan Diego Hern√°ndez Zavala[^2]

[^2]: 2209978x\@umich.mx

<!-- -->

-   Francisco Alvarez Aguilera[^3]

[^3]: 1911217e\@umich.mx

<!-- -->

-   Mario Nathaniel de la Vega Ram√≠rez[^4]

[^4]: 1825934f\@umich.mx


**Universidad Michoacana de San Nicol√°s de Hidalgo**

![](https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg-AEsvi0CFmM6Blq_wM67EJKaDQS7_KEf-4wd9U1J9jqs-oAGip3InqKyKBx0z76wGKFEAtRb9kiKBexyQCZSIE0PC7f-F00I5KqPXn1UL4t8RzDd3qcPsoIRYRi2pqRaIvjppNLAWdkI/s1600/Escudo+UMSNH.jpg){width="20%"}

**Licenciatura en Actuar√≠a y Ciencia de Datos**

![](https://raw.githubusercontent.com/FranciscoAlvarezAguilera/E01-Markowitz/refs/heads/main/logo.png){width="30%"}

\

\

\

## La Teor√≠a de Portafolios de Markowitz

-   Pionera en formalizar matem√°ticamente el concepto de diversificaci√≥n de inversiones.

-   Rendimiento esperado de un portafolio y su riesgo.

-   Minimizar el riesgo para un nivel de rendimiento dado, o maximizar el rendimiento para un nivel de riesgo aceptado.

Conceptos fundamentales:

1.  Riesgo

2.  Rendimiento

### Rendimiento esperado de un activo y de un portafolio

Rendimiento:

-   Activo individual: Cambio en su valor, respecto a su valor inicial.

-   Rendimiento esperado de portafolio: $$ E(R_p) = \sum_{i} w_i \, E(R_i) $$ Forma Matricial: $$ E(R_p) = w' E(r) $$\

### Riesgo (Varianza o Volatilidad) de un portafolio

Medido comunmente como la varianza $$ \sigma^{2} $$ o la desviaci√≥n est√°ndar $$ \sigma $$ de sus rendimientos.

### Covarianza y Correlaci√≥n

$$ \sigma_{ij} $$ Mide la forma en que 2 activos diferentes se mueven juntos.

-   (+) = Misma direcci√≥n, mayor riesgo

-   (-) = Distinta direcci√≥n, menor riesgo total $$ \rho_{ij} $$ Estandariza la covarianza. Valor entre:

-   -1: En teor√≠a, crear un portafolio sin riesgo.

-   1: No beneficio.

### Formulaci√≥n Matem√°tica

$$\sigma^2_p = w' V w $$ Varianza de un portafolio con n activos en notaci√≥n matricial.

| $$\sigma^2_p = w' V w $$ | Varianza del portafolio |
|----|----|
| $$w$$ | Vector columna de ponderaciones de los activos |
| $$w'$$ | Vector traspuesto de las ponderaciones |
| $$V$$ | Matriz de varianza-covarianza de rendimientos de activos |

### El Problema de Markowitz y la Frontera Eficiente

Minimizar $$\ w' V w   y   \Sigma w_i = 1$$

Un inversor racional y adverso al riesgo elegir√° un portafolio que se encuentre sobre la Frontera Eficiente.

![](https://raw.githubusercontent.com/FranciscoAlvarezAguilera/E01-Markowitz/refs/heads/main/frontera.jpeg)

## Valor en Riesgo (VaR)

Seg√∫n el AEI 7.0:

Un portafolio o cartera de inversi√≥n es la combinaci√≥n de activos objeto de inversi√≥n, como lo son todos los valores, t√≠tulos y documentos inscritos en el Registro Nacional de Valores en los que invierte alg√∫n fondo con la intenci√≥n de ‚Äúdiversificar‚Äù el riesgo.

El riesgo en estos contextos se asocia a la incertidumbre en el valor de un activo, que regularmente se cuantifica mediante su:

Varianza y su volatilidad (desviaci√≥n est√°ndar) a lo largo del tiempo del activo(hist√≥rica).

Coeficiente $\beta$: Indica la sensibilidad de un activo ante el mercado.

Para esto se usan las series de tiempo de los rendimientos diarios de ciertos √≠ndices, llamados benchmark que reflejan el comportamiento conjunto, por ejemplo, de las acciones disponibles en el mercado accionario. En M√©xico,el √çndice de Precios y Cotizaciones se saca de una muestra del mercado accionario representativa, ponderada y balanceada, de las acciones que cotizan en la bolsa Mexicana de Valores. Los criterios para su construcci√≥n est√°n disponibles en la p√°gina del S&P Global (BMV). Y la serie de tiempo de los rendimientos de alguna acci√≥n del mercado que quieras analizar. Sean $R_m$ y $R_i$ las variables aleatorias que describen los rendimientos del mercado y el rendimiento de la acci√≥n a analizar en un tiempo determinado t, por ejemplo 5 a√±os. Luego la $\beta_i$ a t a√±os ser√°.

$$Cov(R_m,R_i )\over Var(R_m)$$

Value at Risk(VaR): Es una estimaci√≥n (Hip√≥tesis) de la m√°xima p√©rdida posible en un intervalo de tiempo con cierto nivel de confianza.

Se basa en el supuesto de una distribuci√≥n normal de los rendimientos de un portafolio X, y su representaci√≥n es muy sencilla:

$$VaR_{(1-Œ±)}^X=\mu_X (T-t)-\sigma_X (T-t)z_{(1-Œ±)}$$

Donde $X ~ N(\mu_X (T-t),\sigma_X (T-t))$ $\mu_X:$ es el rendimiento esperado. $\sigma_X:$ la desviaci√≥n est√°ndar de los rendimientos. $z:$ el valor cr√≠tico de la distribuci√≥n normal a $(1-\alpha)100%$ de confianza.

$(T-t)$ es el intervalo de tiempo en el que se analizara el portafolio, donde usualmente se toman 5 y 10 d√≠as($5/360$ √≥ $10/360$)

Adem√°s, Artzener et all(1999) proponen ciertas propiedades para ser considerada una medida coherente de riesgo, a la diversificaci√≥n y sus supuestos que como resulado, no sobrestima la cantidad de perdida y que reflejen de manera adecuada la reducci√≥n del riesgo cuando se diversifica. Sea $X : \Omega \to \mathrm{I\!R}$ es el cambio del valor del portafolio y $A = \{\, X \mid X : \Omega \to \mathrm{I\!R} \,\}$ el conjunto de todos los posibles cambios en el valor del portafolio, d√≥nde Œ© es una v.a asociada al cambio del valor de un portafolio.

Sean $X\space,Y \in A$ Si $\rho‚à∂ A \to\mathrm{I\!R}$ es una medida coherente de riesgo cumple:

Monoton√≠a no creciente. Si $X\leq Y$ entonces $\rho(X) \geq \rho(Y)$

Subadividad. $\rho(X + Y )‚â§ \rho (X ) +\rho(Y )$

Homogeneidad Positiva o Homog√©nea de grado uno. $\lambda\geq0,\space \rho(\lambda X)= \lambda\bullet \rho(X)$

Invarianza ante traslaciones. $\rho(X+\alpha)= \rho(X)-\alpha$

Curiosamente, ni la Varianza ni su volatilidad, ni el coeficiente Beta, ni el VaR tal como est√° definido son medidas de riesgo coherentes, ya que la varianza ni tiene homogeneidad positiva, pues las constantes salen al cuadrado, ni es invariante ante traslaciones, pues la varianza de una variable m√°s una constante es igual a la varianza de la variable, y puede llegar a ser subaditiva, pero todo depende del signo de $2‚àôCov(X,Y)$. Adem√°s, no es capaz de detectar los efectos de colas m√°s pesadas que puede tener consecuencias bastante graves. El coeficiente Beta, y el VaR tal como est√° definido ahora no cumple la propiedad de subaditividad.

Una medida de riesgo coherente es la llamada Esperanza condicional de la cola del VaR o AVaR, CvaR, TVaR, o simplemente Expected Shortfall, . $\varepsilon_{(1-q)}^X=-E[X \space|\space X< -VaR_{(1-q)}^X]$

### Metodolog√≠a para el c√°lculo de VaR

::::: columns
::: {.column width="55%"}
Medida estad√≠stica que cuantifica la p√©rdida m√°xima esperada en periodo de tiempo espec√≠fico con nivel de confianza determinado.

Formalmente: $$P(P_t - P_0 \le -VAR) = 1 - c $$
:::

::: {.column width="45%"}
Donde: $$P_0$$ valor inicial del portafolio $$P_t$$ valor al tiempo t $$c$$ nivel de confianza
:::
:::::

Los 3 m√©todos para el c√°lculo de VaR:

-   Modelo Param√©trico

-   Modelo Hist√≥rico

-   Simulaciones

### Modelo Param√©trico

M√©todo derivado directamente del modelo de Markowitz. Se asume un modelo normal, por lo tanto:

Sea ùë§ el vector de pesos relativos de una cartera: $$w = (w_1, w_2, ...,w_n)$$ Sea ùëü el vector de rendimientos: $$ùëü = (r_1,r_2,..., r_n)$$ Sea ùëâ la matriz sim√©trica de ùëõùë•ùëõ de varianzas y covarianzas de rendimientos.

Sea x la cantidad invertida en cada activo: $$x = (x_1, x_2,...,x_n)$$

Y W la cantidad total invertida: $$W=\sum_{i=1}^{n} x_i$$

De modo que: $$w_i= \frac{x_i}{W}$$

Dada la definici√≥n anterior, la varianza por unidad: $$\sigma^2_p= w^{t}Vw$$ Por lo tanto, en t√©rminos de la inversi√≥n total W: $$\sigma^2_pW^2= x^{t}Vx$$ Al asumir que el rendimiento es normal ùëü ‚àº ùëÅ(¬µ,ùëâ), ,la distribuci√≥n de la cartera es: $$r_c‚àºN(\mu_c,\sigma^2_c),\mu_c= w^{T}\mu$$

Definimos la p√©rdida como: $$L= W-W(1+r_c)=-Wr_c$$ La transformaci√≥n lineal de una variable normal ùëå=ùëéùëã+ùëè es otra variable aleatoria normalmente distribuida de la forma ùëå‚àºùëÅ(ùëé¬µ+ùëè,ùëé^2œÉ^2). Podemos definir la distribuci√≥n de ùêø como: $$L‚àºùëÅ(-W\mu_c,W^2\sigma^2_c)$$ Esto permite definir VaR a nivel de significancia *p* como cuartil superior de ùêø con probabilidad *p*: $$VaR_p=F^{-1}_L(1-p)$$

::::: columns
::: {.column width="50%"}
Donde: $$ùêπ^{-1}_p$$ es funci√≥n inversa de distribuci√≥n acumulada de p√©rdidas. Aplicada a un valor de probabilidad, devuelve valor de p√©rdida para dicha probabilidad de la FDA.
:::

::: {.column width="50%"}
Ahora, para una normal de la forma $$ùëå ‚àº ùëÅ(ùëö, ùë†^2)$$ se tiene que: $$F^{-1}_Y(1-p)=m+s¬∑z_{1-p}$$
:::
:::::

::::: columns
::: {.column width="55%"}
‚áí$$VaR_p=-W\mu_c+z_{1-p}W\sigma_c$$ Pero $$\mu_c=W^T\mu$$ y $$\sigma_c=\sqrt{w^{t}Vw}$$
:::

::: {.column width="45%"}
Por lo tanto, usando la suposici√≥n habitual (tiempo‚â§1 d√≠a, media=0): ¬µ=0. Reescribimos: $$VaR_p=z_{1-p}W\sqrt{w^{t}Vw}$$ $$=z_{1-p}\sqrt{x^{t}Vx}$$
:::
:::::

## Ejemplo Teor√≠a de Portafolio de Markowitz

### Riesgo y retorno esperado

El c√°lculo del rendimiento esperado de una acci√≥n esta dado por su esperanza matem√°tica decacuerdo con el modelo de Markowitz.

Simulando posibles escenarios futuros para la acci√≥n de Qualitas (Q.MX):

|          |          |              |             |
|----------|----------|--------------|-------------|
| Econom√≠a | Precio   | Probabilidad | Rendimiento |
| Auge     | \$230.00 | 25%          | 41.59%      |
| Esperado | \$191.90 | 50%          | 18.14%      |
| Recesi√≥n | \$156.00 | 25%          | -3.95%      |

: Qualitas Controladora, SAB De CV (Q.MX)

#### Retorno esperado

El rendimiento esperado para Qualitas es estonces:

$E(R_Q) = \sum_{i=0}^{n}p*X_i$

$E(R_Q) = (0.25)*(0.4159)+(0.50)*(0.1814)+(0.25)*(-0.0395)$

$E(R_Q) = 0.1848$

#### Riesgo esperado

La desviaci√≥n est√°ndar vista bajo este modelo, es el riesgo del t√≠tulo a evaluar.

$d_Q =\sigma_Q = 0.1610$

### Para una cartera de dos activos:

Para efectos de este ejemplo agregaremos los siguientes datos de la acci√≥n del Banco del Bajio (BBAJIOO.MX):

-   $E(R_B)=0.2611$

-   $\sigma_{B}^{2} = 0.0806$

-   $\sigma_{B} = 0.2839$

-   $Cov(Q,B)=0.02057$

#### F√≥rmula de Markowitz (% optimo)

Utilizando la formula de markowitz se puede llegar al porcentaje(peso) exacto a invertir en cada activo para que el riesgo de la cartera de dos t√≠tulos sea el m√≠nimo:

$$w_Q = \frac{\sigma_B^2 - \text{Cov}(Q, B)}{\sigma_Q^2 + \sigma_B^2 - 2 \cdot \text{Cov}(Q, B)}$$ Sustituyendo nuestros valores tenemos que:

$w_Q=0.918115$

$w_B = 1- w_Q = 0.081843$

Por lo tanto, para esta cartera, debemos invertir mas del 90% de nuestro capital en acciones de Qualitas.

Ahora, para los demas valores esperados de nuestra cartera de dos activos:

-   $E(R_p)= w_Q*E(R_Q)+w_B*E(R_B)$

$E(R_p)= (0.918115)*(0.1848)+(0.081843)*(0.2611)$

$E(R_p)=0.191036$

-   $\sigma_p^2 = w_Q^2 \sigma_Q^2 + w_B^2 \sigma_B^2 + 2 w_Q w_B \text{Cov}(Q, B)$

$\sigma_p^2 = (0.842935)*(0.025921)+(0.006698)*(0.0806)+2*(0.918115)*(0.081843)*(0.02057)$

$\sigma_p^2 = 0.02547$

$\sigma_p = \sqrt{0.02547} = 0.159593$

Esto es que el riesgo de esta cartera es de 15.95% aproximadamente, valor que cimple con la hipotesis de Markowitz de que diversificar con dos activos de diferente correlaci√≥n nos lleva a un menor riesgo de cartera que si invirtieramos en cada acci√≥n de forma independiente.

$$\sigma_p < \sigma_Q < \sigma_B$$

## Ejemplos del c√°lculo del VaR de un portaf√≥lio

-   A fines de ilustraci√≥n, se calcular√° el VaR param√©trico de un portafolio comupuesto por las acci√≥nes de Grupo M√©xico, Televisa, CEMEX y Kimberly-Clark.

```{r, include = FALSE}
library(plotly)
library(tidyverse)
library(lubridate)
library(quadprog)
library(fPortfolio)
library(gt)
library(dplyr)
# Librer√≠a de Yahoo Finance para descargar datos:
source("https://raw.githubusercontent.com/OscarVDelatorreTorres/yahooFinance/main/datosMultiplesYahooFinance.R")


tickerV=c("GMEXICOB.MX","TLEVISACPO.MX","CEMEXCPO.MX","KIMBERA.MX")
deD=Sys.Date()-365
hastaD=Sys.Date()
per="D"
paridadFX="USDMXN=X"
convertirFX=c(FALSE,FALSE,FALSE,FALSE)

Datos=historico_multiples_precios(tickers=tickerV,de=deD,hasta=hastaD,periodicidad=per,fxRate=paridadFX,whichToFX=convertirFX)



```

![](https://raw.githubusercontent.com/MNathaniel4/Admin.Riesgos/refs/heads/main/Imagenes/VaR_mario_2.PNG)

```{r, include = FALSE}
tablaResumenRendimientos=data.frame(Accion=names(Datos$tablaRendimientosCont)[-1],
                        Media = colMeans(Datos$tablaRendimientosCont[,-1]),
                        Mediana = apply(Datos$tablaRendimientosCont[,-1],2,median),
                        DesviacionEstandar=apply(Datos$tablaRendimientosCont[,-1],2,sd),
                        q5=apply(Datos$tablaRendimientosCont[,-1],2, quantile, probs =0.05),
                        q95=apply(Datos$tablaRendimientosCont[,-1],2, quantile, probs=0.95),
                        max=apply(Datos$tablaRendimientosCont[,-1],2,max),
                        min=apply(Datos$tablaRendimientosCont[,-1],2,min))


tablaResumenRendimientos %>%
  gt() %>%
  tab_header(
    title = "Resumen estadistico de cada acci√≥n",
    subtitle = paste0("Infomraci√≥n del ",deD, " al ", hastaD)
  ) %>%
  fmt_number(
    columns = names(tablaResumenRendimientos[-1]),
    decimals = 2
  ) %>%
  cols_label( Accion = "Acci√≥n",
              Media = "Media",
              Mediana = "Mediana",
              DesviacionEstandar = "Desviaci√≥n Est√°ndar",
              q5 = "Percentil 5%",
              q95 = "Percentil 95%",
              max = "M√°ximo",
              min = "M√≠nimo"
  ) %>%
  tab_style(
    style = cell_text(weight = "bold"),
    locations = cells_column_labels()
  ) %>%
  tab_source_note("Cifras en porcentaje(%)")


```

### C√°lculo del portafolio de m√≠nima varianza

```{r, eval=FALSE}

# Enfoque de  prgramaci√≥n cuadraica

# mu =colMeans(Datos$tablaRendimientosCont[,-1])
# sigma = cov(Datos$tablaRendimientosCont[,-1])
# 
# 
# Dmat <- 2*sigma
# dvec <- rep(0, ncol(sigma))
# 
# Amat <- cbind(rep(1, ncol(sigma)), diag(ncol(sigma)))
# bvec <- c(1, rep(0, ncol(sigma)))
# 
# res <- solve.QP(Dmat, dvec, Amat, bvec, meq=1)
# 
# w = res$solution
# 
# 
# r_port = sum(w * mu)
# sigma_port = sqrt(t(w) %*% sigma %*% w)
# sigma_port = sigma_port[1,1]

```

### Resultados

-   De aqu√≠, los pesos que el modelo arroja los pesos adecuados que minimizan la varianza son: $$w = (0.2628, 0.0751, 0.1658, 0.4962)$$

-   Que desenvoca en un rendimiento esperado de $r_{port} =\sum w_i*E[r_i]=  0.0922$ y una desviaci√≥n est√°ndar de $\sigma_{port}= \sqrt{w¬¥\Sigma w} = 1.1399$ , siendo $\Sigma$ la matriz de covarianza.

### C√°lculo del VaR param√©trico del portafolio

-   Con estos elementos procederemos al calculo del VaR param√©trico a un nivel de confianza del 95% y un horizonte de 10 d√≠as, de una suma invertida de \$ 15,000.

$$VaR_{parametrico} = - (q_{1-\alpha} * \sigma_{port} * \sqrt{h})*Valor\ invertido $$ $$VaR_{parametrico} = - (1.645 * 0.0114 * \sqrt{10})*15,000 = 889.3968 $$

```{r, eval=FALSE}
#alpha = 0.05
#h = 10
#VaR_parametrico = 15000 *-((qnorm(1-alpha)*sigma_port*sqrt(h))/100)

```
